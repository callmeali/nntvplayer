/*
	v1.2.1
	author by ljb
	2018.8.6
	require jQuery
*/
(function(d){function g(){this.container=this.elementid=null;this.options={};this.userset={};this.vjs=null}var k={autoplay:!1,preload:!0,loop:!1,width:640,height:480,techOrder:["html5"],type:1,adSource:null,playComplete:function(){},lib:"cms",fit:"fill",bdtongji:!0};g.domid="player";g.prototype={init:function(b){var a=b.container;if(null==a||void 0==a)a=g.domid,document.write('<div id="'+a+'"></div>');this.container=a=d("#"+a);this.userset=b;this.setOptions();a.css("width",this.options.width).css("height",
this.options.height).css("background-color","#000");0<a.length&&this.buildHtml()},setOptions:function(){var b=this;b.options=d.extend({},k,b.userset);void 0!=b.options.videoid&&void 0==b.options.source&&b.videoSource(function(){b.videojs()})},buildHtml:function(){var b=this;this.elementid=Math.round(1E5*Math.random());var a=d('<video id="vjs_'+this.elementid+'" class="video-js vjs-default-skin" controls>');a.css("object-fit",b.options.fit).css("width","100%").css("height","100%");this.container.append(a);
this.container.bind("contextmenu",function(a){b.container.find(".vjs-contextmenu").css("top",a.pageY-b.container.offset().top).css("left",a.pageX-b.container.offset().left).show();return!1});d("body").on("click",function(){b.container.find(".vjs-contextmenu").hide()});this.videojs()},videojs:function(){if(void 0!=this.options.source){var b={},a=this.options.source;a=a.substring(a.lastIndexOf(".")+1);b.sources=[{src:this.options.source,type:{mp4:"video/mp4",m3u8:"application/x-mpegURL"}[a]}];delete this.options.source;
b=d.extend({},this.options,b);null!=this.options.adSource&&(b.autoplay=!1);this.vjs=videojs("vjs_"+this.elementid,b);this.vjs.on("ended",this.options.playComplete);this.customVjs()}},customVjs:function(){var b=this,a=b.vjs,e=videojs.getComponent("Component"),f=new (videojs.extend(e,{el:function(){return videojs.dom.createEl("div",{className:"vjs-logo"})}}))(a);a.controlBar.addChild(f);f=a.getChild("BigPlayButton");a.removeChild(f);var c=new e(a);c.addChild(f);c.addClass("vjs-bigplay-container");a.addChild(c);
e=new (videojs.extend(e,{el:function(){return videojs.dom.createEl("div",{className:"vjs-watermark",innerHTML:"NNTV.cn"})}}))(a);a.addChild(e);b.contextMenu();if(null!=b.options.adSource&&!b.isMobile())a.one("firstplay",function(){b.beforeAd()});b.options.autoplay&&a.play()},videoSource:function(b){var a=this,e="http://api.nntv.cn/?mod=api&ac=player&m=getvideourl&inajax=1",f="cms";"paike"==a.options.lib?(e+="&lib=paike&vid={0}",f="paike"):e+="&globalid={0}";e=e.replace("{0}",a.options.videoid);d.getJSON(e,
function(c){if(0==c.error){var d="object"==typeof c.url?a.isMobile()?c.url.sd:c.url.hd:c.url;d=d.replace(/vodcdn.nntv.cn/,"mvod.nntv.cn");a.options.source=d;a.options.adSource=c.ad;vType=d.slice(d.lastIndexOf("."));b();"undefined"!=typeof _hmt&&"cms"==f&&a.options.bdtongji&&(_hmt.push(["_trackEvent","\u89c6\u9891_\u70b9\u64ad","\u6807\u9898",c.title]),_hmt.push(["_trackEvent","\u89c6\u9891_\u70b9\u64ad","\u9891\u9053",c.channel]))}else console.log("error:"+c.message+" "+e)})},beforeAd:function(){var b=
this,a=b.vjs;a.pause();var e=b.elementid,f=videojs.getComponent("Component");f=videojs.extend(f,{el:function(){return videojs.dom.createEl("div",{className:"vjs-ad",innerHTML:'<div class="vjs-ad-time">\u5e7f\u544a\u5269\u4f59<span id="vjs_ad_time_'+e+'">0</span>\u79d2</div><video id="vjs_ad_'+e+'" src="'+b.options.adSource+'"></video>'})}});videojs.registerComponent("ad",f);f=new f(a);a.addChild(f);var c=document.getElementById("vjs_ad_"+e),d=function(){c.pause();c.parentNode.style.display="none";
a.play()};c.addEventListener("ended",function(){d()},!1);var h=5;c.addEventListener("loadedmetadata",function(){h=Math.round(c.duration);var a=document.getElementById("vjs_ad_time_"+e);a.parentNode.style.display="block";a.innerHTML=h;c.play().catch(function(){c.muted=!0;c.play()})},!1);var g=setInterval(function(){h--;0>h?(clearInterval(g),d()):document.getElementById("vjs_ad_time_"+e).innerHTML=h},1E3)},contextMenu:function(){var b=this.vjs,a=videojs.getComponent("Component");a=new (videojs.extend(a,
{el:function(){return videojs.dom.createEl("div",{className:"vjs-contextmenu",innerHTML:'<div class="line">NntvPlayer</div><div class="line">Ver. 1.2.1</div><div>Author by ljb</div>'})}}))(b);b.addChild(a)},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)}};d.extend({nntvplayer:function(b){(new g).init(b)}});d.fn.extend({nntvplayer:function(b){0!=d(this).length&&(b.container=d(this).attr("id"),d.nntvplayer(b))}});d(document).ready(function(){var b=1;
d(".nntvplayer").each(function(){_self=d(this);var a="nntvplayer"+b;_self.append('<div id="'+a+'"></div>');var e={},f=_self.attr("data-option");null!=f&&void 0!=f&&(e=eval("({"+f+"})"));d("#"+a).nntvplayer(e);b++})});(function(){var b=function(a){var b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)},a=function(){for(var a=document.scripts||document.getElementsByTagName("script"),b,c=a.length;0<c;c--)if(-1<a[c-1].src.indexOf("nntvplayer")){b=
a[c-1].src.substring(0,a[c-1].src.lastIndexOf("/")+1);break}return b}();document.write(unescape("%3Cscript src='"+a+"video.min.js' type='text/javascript'%3E%3C/script%3E"));document.write(unescape("%3Cscript src='"+a+"lang/zh-CN.js' type='text/javascript'%3E%3C/script%3E"));b(a+"video-js.min.css");b(a+"nntvplayer.css")})()})(window.jQuery);