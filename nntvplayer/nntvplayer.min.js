/*
	v1.4.0
	author by ljb
	2019.11.21
	require jQuery
*/
(function(e){function g(){this.container=this.elementid=null;this.options={};this.userOptions={player_volume:null,player_playbackRate:null};this.v=this.vjs=null}var k={autoplay:!1,preload:!0,loop:!1,width:640,height:480,adSource:null,playComplete:function(){},lib:"cms",fit:"fill",bdtongji:!0,volume:.5,playRate:!0,picInPic:!1,language:"zh-CN",techOrder:["html5"],playbackRates:[.75,1,1.25,1.5,2],controlBar:{volumePanel:{inline:!1}}};g.domid="player";g.prototype={init:function(a){var b=a.container;if(null==
b||void 0==b)b=g.domid,document.write('<div id="'+b+'"></div>');this.container=b=e("#"+b);this.options=a;this.setOptions();b.css("width",this.options.width).css("height",this.options.height).css("background-color","#000");0<b.length&&this.buildHtml();return this.vjs},setOptions:function(){var a=this;a.options=e.extend({},k,a.options);a.options.playRate||(a.options.playbackRates=null);a.options.picInPic||(a.options.controlBar.pictureInPictureToggle=!1);void 0!=a.options.videoid&&void 0==a.options.source&&
a.videoSource(function(){a.videojs();if(void 0!=a.options.sources){for(var b={sources:[{format:"sd",src:a.options.sources.sd},{format:"hd",src:a.options.sources.hd}],formats:[{code:"sd",name:"\u6807\u6e05"},{code:"hd",name:"\u9ad8\u6e05"}],onFormatSelected:function(a){console.log(a)}},c=0;c<b.formats.length;c++)if(b.formats[c].code==a.options.stream){b.text=b.formats[c].name;break}a.vjs.qualityselector(b)}})},setUserOptions:function(){for(var a=this,b=[{name:"volume",tag:"player_volume_value",defValue:1},
{name:"muted",tag:"player_volume_muted",defValue:!1},{name:"playbackRate",tag:"player_playback_rate",defValue:1}],c=0;c<b.length;c++){var f=this.userOptions[b[c].tag]=Cookies.get(b[c].tag);if("true"==f||"false"==f)f="true"==f?!0:!1;a.v[b[c].name]=void 0==f?b[c].defValue:f}a.vjs.on("volumechange",function(b){Cookies.set("player_volume_muted",a.v.muted?"true":"false");Cookies.set("player_volume_value",a.v.volume)});a.vjs.on("ratechange",function(b){Cookies.set("player_playback_rate",a.v.playbackRate)})},
buildHtml:function(){var a=this;this.elementid=Math.round(1E5*Math.random());var b=e('<video id="vjs_'+this.elementid+'" class="video-js vjs-default-skin" controls>');b.css("object-fit",a.options.fit).css("width","100%").css("height","100%");this.container.append(b);this.container.bind("contextmenu",function(b){a.container.find(".vjs-contextmenu").css("top",b.pageY-a.container.offset().top).css("left",b.pageX-a.container.offset().left).show();return!1});e("body").on("click",function(){a.container.find(".vjs-contextmenu").hide()});
this.videojs()},videojs:function(){var a=this;if(void 0!=a.options.source){var b={},c=a.options.source;c=c.substring(c.lastIndexOf(".")+1);b.sources=[{src:a.options.source,type:{mp4:"video/mp4",m3u8:"application/x-mpegURL"}[c]}];delete a.options.source;b=e.extend({},a.options,b);null!=a.options.adSource&&(b.autoplay=!1);a.vjs=videojs("vjs_"+a.elementid,b);a.v=document.getElementById("vjs_"+a.elementid+"_html5_api");a.vjs.on("ended",a.options.playComplete);a.vjs.one("loadedmetadata",function(){a.setUserOptions()});
a.customVjs()}},customVjs:function(){var a=this,b=a.vjs,c=videojs.getComponent("Component"),f=new (videojs.extend(c,{el:function(){return videojs.dom.createEl("div",{className:"vjs-logo"})}}))(b);b.controlBar.addChild(f);f=b.getChild("BigPlayButton");b.removeChild(f);var d=new c(b);d.addChild(f);d.addClass("vjs-bigplay-container");b.addChild(d);c=new (videojs.extend(c,{el:function(){return videojs.dom.createEl("div",{className:"vjs-watermark",innerHTML:"NNTV.cn"})}}))(b);b.addChild(c);a.contextMenu();
if(null!=a.options.adSource&&!a.isMobile())b.one("firstplay",function(){a.beforeAd()});a.options.autoplay&&b.play()},videoSource:function(a){var b=this,c="http://api.nntv.cn/?mod=api&ac=player&m=getvideourl&inajax=1",f="cms";"paike"==b.options.lib?(c+="&lib=paike&vid={0}",f="paike"):c+="&globalid={0}";c=c.replace("{0}",b.options.videoid);e.getJSON(c,function(d){if(0==d.error){if("object"==typeof d.url){b.options.stream=b.isMobile()?"sd":"hd";var e=d.url[b.options.stream];b.options.sources=d.url}else e=
d.url;e=e.replace(/vodcdn.nntv.cn/,"mvod.nntv.cn");b.options.source=e;b.options.adSource=d.ad;vType=e.slice(e.lastIndexOf("."));a();"undefined"!=typeof _hmt&&"cms"==f&&b.options.bdtongji&&(_hmt.push(["_trackEvent","\u89c6\u9891_\u70b9\u64ad","\u6807\u9898",d.title]),_hmt.push(["_trackEvent","\u89c6\u9891_\u70b9\u64ad","\u9891\u9053",d.channel]))}else console.log("error:"+d.message+" "+c)})},beforeAd:function(){var a=this,b=a.vjs;b.pause();var c=a.elementid,f=videojs.getComponent("Component");f=videojs.extend(f,
{el:function(){return videojs.dom.createEl("div",{className:"vjs-ad",innerHTML:'<div class="vjs-ad-time">\u5e7f\u544a\u5269\u4f59<span id="vjs_ad_time_'+c+'">0</span>\u79d2</div><video id="vjs_ad_'+c+'" src="'+a.options.adSource+'"></video>'})}});videojs.registerComponent("ad",f);f=new f(b);b.addChild(f);var d=document.getElementById("vjs_ad_"+c),e=function(){d.pause();d.parentNode.style.display="none";b.play()};d.addEventListener("ended",e,!1);var h=5;d.addEventListener("loadedmetadata",function(){h=
Math.round(d.duration);var a=document.getElementById("vjs_ad_time_"+c);a.parentNode.style.display="block";a.innerHTML=h;d.play().catch(function(){d.muted=!0;d.play()})},!1);var g=setInterval(function(){h--;0>h?(clearInterval(g),e()):document.getElementById("vjs_ad_time_"+c).innerHTML=h},1E3)},contextMenu:function(){var a=this.vjs,b=videojs.getComponent("Component");b=new (videojs.extend(b,{el:function(){return videojs.dom.createEl("div",{className:"vjs-contextmenu",innerHTML:'<div class="line">NntvPlayer</div><div class="line">Ver. 1.4.0</div><div>Author by ljb</div>'})}}))(a);
a.addChild(b)},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)}};e.extend({nntvplayer:function(a){return(new g).init(a)}});e.fn.extend({nntvplayer:function(a){if(0!=e(this).length)return a.container=e(this).attr("id"),e.nntvplayer(a)}});e(document).ready(function(){var a=1;e(".nntvplayer").each(function(){_self=e(this);var b="nntvplayer"+a;_self.append('<div id="'+b+'"></div>');var c={},f=_self.attr("data-option");null!=f&&void 0!=f&&(c=eval("({"+f+
"})"));e("#"+b).nntvplayer(c);a++})});(function(){var a=function(a){var b=document.createElement("link");b.rel="stylesheet";b.type="text/css";b.href=a;document.getElementsByTagName("head")[0].appendChild(b)},b=function(){for(var a=document.scripts||document.getElementsByTagName("script"),b,d=a.length;0<d;d--)if(-1<a[d-1].src.indexOf("nntvplayer")){b=a[d-1].src.substring(0,a[d-1].src.lastIndexOf("/")+1);break}return b}();document.write(unescape("%3Cscript src='"+b+"video.min.js' type='text/javascript'%3E%3C/script%3E"));
document.write(unescape("%3Cscript src='"+b+"videojs-qualityselector.min.js' type='text/javascript'%3E%3C/script%3E"));document.write(unescape("%3Cscript src='"+b+"lang/zh-CN.js' type='text/javascript'%3E%3C/script%3E"));document.write(unescape("%3Cscript src='"+b+"cookie.js' type='text/javascript'%3E%3C/script%3E"));a(b+"video-js.min.css");a(b+"nntvplayer.css")})()})(window.jQuery);