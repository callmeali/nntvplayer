/*
	v1.5.0
	author by ljb
	2019.11.21
	require jQuery
*/
(function(d){function g(){this.container=this.elementid=null;this.options={};this.userOptions={player_volume:null,player_playbackRate:null};this.nextVideoList=this.v=this.vjs=null}var k={autoplay:!1,preload:!0,loop:!1,width:640,height:480,adSource:null,playComplete:function(){},enableNextVideoList:!0,lib:"cms",fit:"fill",bdtongji:!0,volume:.5,playRate:!0,picInPic:!1,language:"zh-CN",techOrder:["html5"],playbackRates:[.75,1,1.25,1.5,2],controlBar:{volumePanel:{inline:!1},liveControl:!0}};g.domid="player";
g.prototype={init:function(b){var a=b.container;if(null==a||void 0==a)a=g.domid,document.write('<div id="'+a+'"></div>');this.container=a=d("#"+a);this.options=b;this.setOptions();a.css("width",this.options.width).css("height",this.options.height).css("background-color","#000");0<a.length&&this.buildHtml();return this.vjs},setOptions:function(){var b=this;b.options=d.extend({},k,b.options);b.options.playRate||(b.options.playbackRates=null);b.options.picInPic||(b.options.controlBar.pictureInPictureToggle=
!1);void 0!=b.options.videoid&&void 0==b.options.source&&b.videoSource(function(){b.videojs();if(void 0!=b.options.sources){for(var a={sources:[{format:"sd",src:b.options.sources.sd},{format:"hd",src:b.options.sources.hd}],formats:[{code:"sd",name:"\u6807\u6e05"},{code:"hd",name:"\u9ad8\u6e05"}],onFormatSelected:function(b){console.log(b)}},c=0;c<a.formats.length;c++)if(a.formats[c].code==b.options.stream){a.text=a.formats[c].name;break}b.vjs.qualityselector(a)}})},setUserOptions:function(){for(var b=
this,a=[{name:"volume",tag:"player_volume_value",defValue:1},{name:"muted",tag:"player_volume_muted",defValue:!1},{name:"playbackRate",tag:"player_playback_rate",defValue:1}],c=0;c<a.length;c++){var e=this.userOptions[a[c].tag]=Cookies.get(a[c].tag);if("true"==e||"false"==e)e="true"==e?!0:!1;b.v[a[c].name]=void 0==e?a[c].defValue:e}b.vjs.on("volumechange",function(a){Cookies.set("player_volume_muted",b.v.muted?"true":"false");Cookies.set("player_volume_value",b.v.volume)});b.vjs.on("ratechange",function(a){Cookies.set("player_playback_rate",
b.v.playbackRate)})},buildHtml:function(){var b=this;this.elementid=Math.round(1E5*Math.random());var a=d('<video id="vjs_'+this.elementid+'" class="video-js vjs-default-skin" controls>');a.css("object-fit",b.options.fit).css("width","100%").css("height","100%");this.container.append(a);this.container.bind("contextmenu",function(a){b.container.find(".vjs-contextmenu").css("top",a.pageY-b.container.offset().top).css("left",a.pageX-b.container.offset().left).show();return!1});d("body").on("click",function(){b.container.find(".vjs-contextmenu").hide()});
this.videojs()},videojs:function(){var b=this;if(void 0!=b.options.source){var a={},c=b.options.source;c=c.substring(c.lastIndexOf(".")+1);a.sources=[{src:b.options.source,type:{mp4:"video/mp4",m3u8:"application/x-mpegURL"}[c]}];delete b.options.source;a=d.extend({},b.options,a);null!=b.options.adSource&&(a.autoplay=!1);b.vjs=videojs("vjs_"+b.elementid,a);b.v=document.getElementById("vjs_"+b.elementid+"_html5_api");b.vjs.on("ended",function(){b.options.playComplete();b.options.enableNextVideoList&&
(b.getNextVideoList(),b.vjs.nextVideoList.show())});b.vjs.on("playing",function(){b.vjs.nextVideoList.hide()});b.vjs.one("loadedmetadata",function(){b.setUserOptions()});b.customVjs()}},customVjs:function(){var b=this,a=b.vjs,c=videojs.getComponent("Component"),e=new (videojs.extend(c,{el:function(){return videojs.dom.createEl("div",{className:"vjs-logo"})}}))(a);a.controlBar.addChild(e);e=a.getChild("BigPlayButton");a.removeChild(e);var f=new c(a);f.addChild(e);f.addClass("vjs-bigplay-container");
a.addChild(f);e=new (videojs.extend(c,{el:function(){return videojs.dom.createEl("div",{className:"vjs-watermark",innerHTML:"NNTV.cn"})}}))(a);a.addChild(e);b.contextMenu();c=new (videojs.extend(c,{el:function(){var b=videojs.dom.createEl("div",{className:"vjs-next-video-list-container"}),c=videojs.dom.createEl("div",{className:"vjs-next-video-list"}),e=videojs.dom.createEl("div",{className:"left"}),f=videojs.dom.createEl("div",{className:"right"}),d=videojs.dom.createEl("span",{className:"replay"});
d.onclick=function(){a.nextVideoList.hide();a.play()};e.appendChild(d);d=videojs.dom.createEl("div",{className:"list"});f.appendChild(d);c.appendChild(e);c.appendChild(f);d.appendChild(videojs.dom.createEl("ul"));b.appendChild(c);b.show=function(){a.nextVideoList.classList.remove("vjs-hidden")};b.hide=function(){a.nextVideoList.classList.add("vjs-hidden")};a.nextVideoList=b;a.nextVideoList.hide();return b}}))(a);a.addChild(c);b.getNextVideoList();if(null!=b.options.adSource&&!b.isMobile())a.one("firstplay",
function(){b.beforeAd()});b.options.autoplay&&a.play()},videoSource:function(b){var a=this,c="http://api.nntv.cn/?mod=api&ac=player&m=getvideourl&inajax=1",e="cms";"paike"==a.options.lib?(c+="&lib=paike&vid={0}",e="paike"):c+="&globalid={0}";c=c.replace("{0}",a.options.videoid);d.getJSON(c,function(f){if(0==f.error){if("object"==typeof f.url){a.options.stream=a.isMobile()?"sd":"hd";var d=f.url[a.options.stream];a.options.sources=f.url}else d=f.url;d=d.replace(/vodcdn.nntv.cn/,"mvod.nntv.cn");a.options.source=
d;a.options.adSource=f.ad;vType=d.slice(d.lastIndexOf("."));b();"undefined"!=typeof _hmt&&"cms"==e&&a.options.bdtongji&&(_hmt.push(["_trackEvent","\u89c6\u9891_\u70b9\u64ad","\u6807\u9898",f.title]),_hmt.push(["_trackEvent","\u89c6\u9891_\u70b9\u64ad","\u9891\u9053",f.channel]))}else console.log("error:"+f.message+" "+c)})},beforeAd:function(){var b=this,a=b.vjs;a.pause();var c=b.elementid,e=videojs.getComponent("Component");e=videojs.extend(e,{el:function(){return videojs.dom.createEl("div",{className:"vjs-ad",
innerHTML:'<div class="vjs-ad-time">\u5e7f\u544a\u5269\u4f59<span id="vjs_ad_time_'+c+'">0</span>\u79d2</div><video id="vjs_ad_'+c+'" src="'+b.options.adSource+'"></video>'})}});videojs.registerComponent("ad",e);e=new e(a);a.addChild(e);var f=document.getElementById("vjs_ad_"+c),d=function(){f.pause();f.parentNode.style.display="none";a.play()};f.addEventListener("ended",d,!1);var h=5;f.addEventListener("loadedmetadata",function(){h=Math.round(f.duration);var b=document.getElementById("vjs_ad_time_"+
c);b.parentNode.style.display="block";b.innerHTML=h;f.play().catch(function(){f.muted=!0;f.play()})},!1);var g=setInterval(function(){h--;0>h?(clearInterval(g),d()):document.getElementById("vjs_ad_time_"+c).innerHTML=h},1E3)},contextMenu:function(){var b=this.vjs,a=videojs.getComponent("Component");a=new (videojs.extend(a,{el:function(){return videojs.dom.createEl("div",{className:"vjs-contextmenu",innerHTML:'<div class="line">NntvPlayer</div><div class="line">Ver. 1.4.0</div><div>Author by ljb</div>'})}}))(b);
b.addChild(a)},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)},getNextVideoList:function(){var b=this;if("undefined"==typeof comment_object_id||"undefined"==typeof channelId||"undefined"==typeof tag)d(b.vjs.nextVideoList).find(".right").css("display","none"),d(b.vjs.nextVideoList).find(".left").css("width","100%");else{var a="http://user.nntv.cn/nnplatform/?mod=api&ac=lyw&m=xgyd&inajax=1&return=json&key={{key}}&channelid={{channel}}&id={{id}}".replace("{{key}}",
tag);a=a.replace("{{id}}",comment_object_id);a=a.replace("{{channel}}",channelId);d.get(a,function(a){a=eval("("+a+")");for(var c=0;c<a.length;c++){var f=videojs.dom.createEl("li");f.innerHTML='<a href="'+a[c].href+'"><div class="thumb"><img src="'+a[c].photo+'"/></div><div class="title"><div>'+a[c].title+"</div></div></a>";d(b.vjs.nextVideoList).find("ul").append(f)}})}}};d.extend({nntvplayer:function(b){return(new g).init(b)}});d.fn.extend({nntvplayer:function(b){if(0!=d(this).length)return b.container=
d(this).attr("id"),d.nntvplayer(b)}});d(document).ready(function(){var b=1;d(".nntvplayer").each(function(){_self=d(this);var a="nntvplayer"+b;_self.append('<div id="'+a+'"></div>');var c={},e=_self.attr("data-option");null!=e&&void 0!=e&&(c=eval("({"+e+"})"));d("#"+a).nntvplayer(c);b++})});(function(){var b=function(b){var a=document.createElement("link");a.rel="stylesheet";a.type="text/css";a.href=b;document.getElementsByTagName("head")[0].appendChild(a)},a=function(){for(var a=document.scripts||
document.getElementsByTagName("script"),b,d=a.length;0<d;d--)if(-1<a[d-1].src.indexOf("nntvplayer")){b=a[d-1].src.substring(0,a[d-1].src.lastIndexOf("/")+1);break}return b}();document.write(unescape("%3Cscript src='"+a+"video.min.js' type='text/javascript'%3E%3C/script%3E"));document.write(unescape("%3Cscript src='"+a+"videojs-qualityselector.min.js' type='text/javascript'%3E%3C/script%3E"));document.write(unescape("%3Cscript src='"+a+"lang/zh-CN.js' type='text/javascript'%3E%3C/script%3E"));document.write(unescape("%3Cscript src='"+
a+"cookie.js' type='text/javascript'%3E%3C/script%3E"));b(a+"video-js.min.css");b(a+"nntvplayer.css")})()})(window.jQuery);